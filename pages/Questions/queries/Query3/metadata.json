{
  "gitSyncId": "64b92e3951b06c6cdc1f0c88_0a0edc8c-4921-4ae6-83fb-b264a8bef75a",
  "id": "Questions_Query3",
  "pluginId": "postgres-plugin",
  "pluginType": "DB",
  "unpublishedAction": {
    "actionConfiguration": {
      "body": "SELECT \n    filteredUsers.\"userId\" AS \"FreeUsers\",\n    COALESCE(\"UserProfile\".\"phone\", \"User\".\"phone\") AS \"PhoneNumber\"\nFROM (\n    SELECT \n        \"userId\",\n        SUM(\"eventCount\") AS \"totalQuestions\",\n        MAX(\"eventDate\") AS \"lastEventDate\"\n    FROM \n        \"DailyUserEvent\"\n    WHERE \n        \"event\" = 'Question'\n        AND \"eventDate\" > '2024-05-05' -- Only consider events of type 'Question'\n    GROUP BY \n        \"userId\"\n    HAVING \n        SUM(\"eventCount\") > 1000 -- Filter users who practiced between 200 and 500 questions\n        AND MAX(\"eventDate\") > '2025-01-01' -- Ensure the latest event date for the user is after January 1, 2025\n) AS filteredUsers\nLEFT JOIN \"UserProfile\" \n    ON filteredUsers.\"userId\" = \"UserProfile\".\"userId\" -- Join to get phone numbers from UserProfile\nLEFT JOIN \"User\" \n    ON filteredUsers.\"userId\" = \"User\".\"id\" -- Join to get phone numbers from User\nWHERE \n    filteredUsers.\"userId\" NOT IN (\n        SELECT DISTINCT \"userId\"\n        FROM \"UserCourse\"\n        WHERE \"expiryAt\" > '2025-02-28' OR \"courseId\" = 2135\n        -- Active course as of today\n    );\n",
      "encodeParamsToggle": true,
      "paginationType": "NONE",
      "pluginSpecifiedTemplates": [
        {
          "value": true
        }
      ],
      "timeoutInMillisecond": 100000
    },
    "confirmBeforeExecute": false,
    "datasource": {
      "id": "learner1",
      "isAutoGenerated": false,
      "name": "learner1",
      "pluginId": "postgres-plugin"
    },
    "dynamicBindingPathList": [],
    "executeOnLoad": true,
    "name": "Query3",
    "pageId": "Questions",
    "userSetOnLoad": false
  }
}